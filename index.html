<!DOCTYPE html>
<!-- 
  PERUBAHAN: 
  1. Bahasa default diubah ke 'en' (Inggris)
  2. Semua teks statis di HTML akan dalam bahasa Inggris
  3. Fungsionalitas terjemahan (setLanguage) akan menangani perubahan ke 'id'
-->
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator Pro</title>

    <!-- Muat Library QR Code -->
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    
    <!-- Muat Library Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 1. Konfigurasi Tailwind untuk Dark Mode -->
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    
    <!-- 2. Muat Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <!-- 3. Skrip Inisialisasi Mode Gelap (Pencegah FOUC) -->
    <script>
        // Terapkan tema dari localStorage sebelum halaman dimuat
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    
    <style>
        /* Sembunyikan input file asli */
        input[type="file"].hidden {
            display: none;
        }
        /* Style untuk label input file kustom */
        .custom-file-upload {
            border: 1px solid #ccc;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
        }
        
        /* Style untuk ikon dark mode toggle */
        #theme-toggle .sun-icon,
        .dark #theme-toggle .moon-icon {
            display: block;
        }
        .dark #theme-toggle .sun-icon,
        #theme-toggle .moon-icon {
            display: none;
        }

        /* Style untuk tombol bahasa */
        #lang-toggle {
            font-weight: 600;
            width: 40px; /* Lebar tetap agar layout tidak bergeser */
            text-align: center;
        }

        /* Style untuk Modal History */
        #history-modal {
            background-color: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease;
        }
        /* Style untuk scrollbar di modal */
        #history-content::-webkit-scrollbar {
            width: 8px;
        }
        #history-content::-webkit-scrollbar-thumb {
            background-color: #4f46e5; /* indigo-600 */
            border-radius: 4px;
        }
        .dark #history-content::-webkit-scrollbar-thumb {
            background-color: #6366f1; /* indigo-500 */
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 font-sans leading-relaxed text-gray-900 dark:text-gray-100">

    <!-- 
      Struktur Aplikasi:
      - generator-ui: Tampilan utama aplikasi (default)
      - landing-page-ui: Tampilan Halaman Arahan (link-in-bio)
      - history-modal: Panel pop-up untuk IndexedDB
    -->
    
    <!-- Bagian 1: UI Generator (Default) -->
    <div id="generator-ui" class="min-h-screen">
        <!-- 
          PERUBAHAN: 
          - Header dibuat 'sticky'
          - Menambahkan 'z-50' agar selalu di atas
          - Menambahkan tombol bahasa
          - PERUBAHAN BARU: Menambahkan tombol "My Codes"
        -->
        <header class="bg-white dark:bg-gray-800 shadow-md dark:shadow-gray-700 sticky top-0 z-50">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100" data-lang="title">QR Code Generator Pro</h1>
                    <p class="text-gray-600 dark:text-gray-300" data-lang="subtitle">Free QR Code Generator PRO Multi Function</p>
                </div>
                <div class="flex items-center gap-2">
                    <!-- Tombol "My Codes" -->
                    <button id="my-codes-btn" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" title="My Codes">
                        <i data-lucide="archive" class="w-6 h-6"></i>
                    </button>
                    <!-- Tombol Bahasa -->
                    <button id="lang-toggle" class="p-2 rounded-full text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" title="Ganti Bahasa">
                        ID
                    </button>
                    <!-- Tombol Dark Mode -->
                    <button id="theme-toggle" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700" title="Toggle Dark Mode">
                        <i data-lucide="sun" class="w-6 h-6 sun-icon"></i>
                        <i data-lucide="moon" class="w-6 h-6 moon-icon"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- 
          PERUBAHAN: 
          - Menambahkan 'pt-6' agar ada padding di bawah header sticky 
        -->
        <main class="container mx-auto p-4 pt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Kolom 1: Input Data -->
            <div class="lg:col-span-1 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg dark:shadow-none space-y-6">
                <!-- Pilihan Tipe QR -->
                <div>
                    <h2 class="text-xl font-semibold mb-3" data-lang="heading1">1. Select QR Code Type</h2>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="tab-btn-single" class="flex-1 p-3 text-sm font-medium bg-indigo-600 text-white rounded-md flex items-center justify-center gap-2">
                            <i data-lucide="link" class="w-4 h-4"></i> <span data-lang="tabSingle">Single URL</span>
                        </button>
                        <button id="tab-btn-multi" class="flex-1 p-3 text-sm font-medium bg-white text-gray-700 hover:bg-gray-50 rounded-md flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">
                            <i data-lucide="list-tree" class="w-4 h-4"></i> <span data-lang="tabMulti">Multi URL</span>
                        </button>
                        <button id="tab-btn-vcard" class="flex-1 p-3 text-sm font-medium bg-white text-gray-700 hover:bg-gray-50 rounded-md flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">
                            <i data-lucide="contact" class="w-4 h-4"></i> <span data-lang="tabVcard">vCard</span>
                        </button>
                        <button id="tab-btn-whatsapp" class="flex-1 p-3 text-sm font-medium bg-white text-gray-700 hover:bg-gray-50 rounded-md flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">
                            <i data-lucide="message-circle" class="w-4 h-4"></i> <span data-lang="tabWhatsapp">WhatsApp</span>
                        </button>
                    </div>
                </div>

                <!-- Panel Input untuk Single URL -->
                <div id="tab-panel-single" class="space-y-4">
                    <label for="single-url" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="singleUrlLabel">Enter your URL</label>
                    <input type="url" id="single-url" data-lang-placeholder="singleUrlPlaceholder" placeholder="https://www.google.com" class="data-input w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <!-- Panel Input untuk Multi URL -->
                <div id="tab-panel-multi" class="space-y-4 hidden">
                    <div>
                        <label for="multi-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="multiTitleLabel">Page Title</label>
                        <input type="text" id="multi-title" data-lang-placeholder="multiTitlePlaceholder" placeholder="My Business Name" class="data-input w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    
                    <h3 class="text-md font-medium text-gray-700 dark:text-gray-300 pt-2" data-lang="multiLinksHeading">Links</h3>
                    <div id="multi-links-container" class="space-y-3">
                        <!-- Tautan dinamis akan ditambahkan di sini oleh JS -->
                    </div>
                    
                    <button id="add-link-btn" class="w-full flex items-center justify-center gap-2 px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        <span data-lang="multiAddLink">Add Link</span>
                    </button>
                </div>

                <!-- Panel Input untuk vCard -->
                <div id="tab-panel-vcard" class="space-y-4 hidden">
                    <h3 class="text-md font-medium text-gray-700 dark:text-gray-300" data-lang="vcardHeading">Enter Contact Details (vCard)</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="vcard-first-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="vcardFirstName">First Name</label>
                            <input type="text" id="vcard-first-name" data-lang-placeholder="vcardFirstNamePlaceholder" placeholder="John" class="vcard-input data-input w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                        <div>
                            <label for="vcard-last-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="vcardLastName">Last Name</label>
                            <input type="text" id="vcard-last-name" data-lang-placeholder="vcardLastNamePlaceholder" placeholder="Doe" class="vcard-input data-input w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>
                    <div>
                        <label for="vcard-phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="vcardPhone">Phone No.</label>
                        <input type="tel" id="vcard-phone" data-lang-placeholder="vcardPhonePlaceholder" placeholder="+112345678" class="vcard-input data-input w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="vcard-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="vcardEmail">Email</label>
                        <input type="email" id="vcard-email" data-lang-placeholder="vcardEmailPlaceholder" placeholder="john.doe@example.com" class="vcard-input data-input w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="vcard-company" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="vcardCompany">Company</label>
                        <input type="text" id="vcard-company" data-lang-placeholder="vcardCompanyPlaceholder" placeholder="Acme Inc." class="vcard-input data-input w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="vcard-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="vcardJobTitle">Job Title</label>
                        <input type="text" id="vcard-title" data-lang-placeholder="vcardJobTitlePlaceholder" placeholder="Manager" class="vcard-input data-input w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="vcard-note" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="vcardNote">Note</label>
                        <textarea id="vcard-note" data-lang-placeholder="vcardNotePlaceholder" placeholder="Additional notes..." rows="2" class="vcard-input data-input w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>

                    <!-- Input Sosial Media -->
                    <div class="space-y-2 pt-4 border-t border-gray-200 dark:border-gray-700 mt-4">
                        <h4 class="text-md font-medium text-gray-700 dark:text-gray-300" data-lang="vcardSocialHeading">Social Media Profiles</h4>
                        <p class="text-xs text-gray-500 dark:text-gray-400 -mt-1 mb-3" data-lang="vcardSocialHint">Just enter your username.</p>
                        <div class="grid grid-cols-2 gap-x-4 gap-y-3">
                            <div>
                                <label for="vcard-social-facebook" class="block text-xs font-medium text-gray-600 dark:text-gray-400">Facebook</label>
                                <input type="text" id="vcard-social-facebook" data-lang-placeholder="vcardSocialPlaceholder" placeholder="Username" class="vcard-input data-input w-full mt-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="vcard-social-instagram" class="block text-xs font-medium text-gray-600 dark:text-gray-400">Instagram</label>
                                <input type="text" id="vcard-social-instagram" data-lang-placeholder="vcardSocialPlaceholder" placeholder="Username" class="vcard-input data-input w-full mt-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="vcard-social-tiktok" class="block text-xs font-medium text-gray-600 dark:text-gray-400">TikTok</label>
                                <input type="text" id="vcard-social-tiktok" data-lang-placeholder="vcardSocialPlaceholder" placeholder="@Username" class="vcard-input data-input w-full mt-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="vcard-social-linkedin" class="block text-xs font-medium text-gray-600 dark:text-gray-400">LinkedIn</label>
                                <input type="text" id="vcard-social-linkedin" data-lang-placeholder="vcardSocialPlaceholder" placeholder="Username" class="vcard-input data-input w-full mt-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="vcard-social-twitter" class="block text-xs font-medium text-gray-600 dark:text-gray-400">X (Twitter)</label>
                                <input type="text" id="vcard-social-twitter" data-lang-placeholder="vcardSocialPlaceholder" placeholder="@Username" class="vcard-input data-input w-full mt-1 px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm">
                            </div>
                        </div>
                        <div id="vcard-custom-socials-container" class="space-y-3 pt-2">
                            <!-- Sosial media kustom akan ditambahkan di sini -->
                        </div>
                        <button id="vcard-add-social-btn" class="w-full flex items-center justify-center gap-2 px-3 py-2 border border-dashed border-gray-400 dark:border-gray-500 text-sm font-medium rounded-md text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 mt-3">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            <span data-lang="vcardAddSocial">Add Other Social</span>
                        </button>
                    </div>

                    <!-- Kolom Kustom -->
                    <div class="space-y-2 pt-4 border-t border-gray-200 dark:border-gray-700 mt-4">
                        <h4 class="text-md font-medium text-gray-700 dark:text-gray-300" data-lang="vcardCustomHeading">Other Custom Fields</h4>
                        <div id="vcard-custom-fields-container" class="space-y-3">
                            <!-- Field kustom dinamis akan ditambahkan di sini -->
                        </div>
                        <button id="vcard-add-field-btn" class="w-full flex items-center justify-center gap-2 px-3 py-2 border border-dashed border-gray-400 dark:border-gray-500 text-sm font-medium rounded-md text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            <span data-lang="vcardAddCustom">Add Custom Field</span>
                        </button>
                    </div>
                </div>

                <!-- Panel Input untuk WhatsApp -->
                <div id="tab-panel-whatsapp" class="space-y-4 hidden">
                    <h3 class="text-md font-medium text-gray-700 dark:text-gray-300" data-lang="waHeading">Enter WhatsApp Number</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400" data-lang="waHint">Will be auto-formatted to a <code class="text-xs bg-gray-200 dark:bg-gray-600 p-1 rounded">wa.me</code> link.</p>
                    <div>
                        <label for="whatsapp-number" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="waLabel">WhatsApp Number</label>
                        <input type="tel" id="whatsapp-number" data-lang-placeholder="waPlaceholder" placeholder="08123456789" class="data-input w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>

            </div>

            <!-- Kolom 2: Kustomisasi -->
            <div class="lg:col-span-1 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg dark:shadow-none space-y-6">
                <h2 class="text-xl font-semibold mb-3" data-lang="heading2">2. Customize Design</h2>
                
                <div>
                    <h3 class="text-md font-medium text-gray-700 dark:text-gray-300" data-lang="styleColors">Colors</h3>
                    <div class="mt-2 grid grid-cols-2 gap-4">
                        <div>
                            <label for="color-dots" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="styleDotsColor">Dots</label>
                            <input type="color" id="color-dots" value="#000000" class="w-full h-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="color-bg" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="styleBgColor">Background</label>
                            <input type="color" id="color-bg" value="#ffffff" class="w-full h-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="color-corner-square" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="styleCornerSquareColor">Corner Square</label>
                            <input type="color" id="color-corner-square" value="#000000" class="w-full h-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm">
                        </div>
                        <div>
                            <label for="color-corner-dot" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="styleCornerDotColor">Corner Dot</label>
                            <input type="color" id="color-corner-dot" value="#000000" class="w-full h-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm">
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-md font-medium text-gray-700 dark:text-gray-300" data-lang="styleStyles">Styles</h3>
                    <div class="mt-2 grid grid-cols-2 gap-4">
                        <div>
                            <label for="style-dots" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="styleDotsStyle">Dots Style</label>
                            <select id="style-dots" class="w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="square" data-lang="styleSquare">Square</option>
                                <option value="dots" data-lang="styleDots">Dots</option>
                                <option value="rounded" data-lang="styleRounded">Rounded</option>
                                <option value="extra-rounded" data-lang="styleExtraRounded">Extra Rounded</option>
                                <option value="classy" data-lang="styleClassy">Classy</option>
                                <option value="classy-rounded" data-lang="styleClassyRounded">Classy Rounded</option>
                            </select>
                        </div>
                        <div>
                            <label for="style-corner-square" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="styleCornerStyle">Corner Style</label>
                            <select id="style-corner-square" class="w-full mt-1 px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="square" data-lang="styleSquare">Square</option>
                                <option value="dot" data-lang="styleDot">Dot</option>
                                <option value="extra-rounded" data-lang="styleExtraRounded">Extra Rounded</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-md font-medium text-gray-700 dark:text-gray-300" data-lang="styleLogo">Logo</h3>
                    <div class="mt-2 flex items-center gap-4">
                        <label for="logo-upload" class="flex-1 text-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 cursor-pointer">
                            <i data-lucide="upload-cloud" class="w-4 h-4 inline-block mr-2"></i>
                            <span data-lang="styleUploadLogo">Select Logo</span>
                        </label>
                        <input type="file" id="logo-upload" accept="image/png, image/jpeg, image/svg+xml" class="hidden">
                        <button id="logo-remove" class="p-2 text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-500">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>

            </div>

            <!-- Kolom 3: Preview dan Download -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Preview QR Code -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg dark:shadow-none">
                    <h2 class="text-xl font-semibold mb-4" data-lang="heading3">3. Preview & Download</h2>
                    <div class="flex justify-center items-center p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-700 min-h-[250px]">
                        <div id="qr-canvas-wrapper" class="w-56 h-56"></div>
                    </div>

                    <!-- Share Link Wrapper -->
                    <div id="share-link-wrapper" class="mt-4 space-y-1 hidden">
                        <label for="share-link-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300" data-lang="shareLink">Shareable Link (Multi URL)</label>
                        <div class="flex gap-2">
                            <input type="text" id="share-link-input" readonly class="w-full px-3 py-2 text-sm bg-gray-100 dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm">
                            <button id="copy-link-btn" class="p-2 flex-shrink-0 border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 rounded-md hover:bg-gray-100 dark:hover:bg-gray-600">
                                <i data-lucide="copy" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>

                    <div class="mt-4 grid grid-cols-2 gap-3">
                        <button id="download-png-btn" class="w-full flex items-center justify-center gap-2 px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span data-lang="downloadPNG">Download PNG</span>
                        </button>
                        <button id="download-svg-btn" class="w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            <span data-lang="downloadSVG">Download SVG</span>
                        </button>
                    </div>

                    <!-- Tombol Save -->
                    <button id="save-qr-btn" class="w-full mt-3 flex items-center justify-center gap-2 px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        <span data-lang="saveCode">Save Code</span>
                    </button>
                </div>

                <!-- Preview Halaman Multi URL -->
                <div id="multi-url-preview-wrapper" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg dark:shadow-none hidden">
                    <h2 class="text-xl font-semibold mb-4" data-lang="multiPreviewHeading">Multi-URL Page Preview</h2>
                    
                    <div class="w-full max-w-sm mx-auto bg-white dark:bg-gray-800 border-8 border-gray-800 dark:border-gray-900 rounded-3xl shadow-xl overflow-hidden">
                        <div class="w-full h-4 bg-gray-800 dark:bg-gray-900 flex justify-center items-center relative">
                            <div class="w-2 h-2 bg-gray-900 dark:bg-black rounded-full"></div>
                        </div>
                        <div id="multi-url-preview-content" class="p-4 h-80 overflow-y-auto bg-gray-50 dark:bg-gray-700">
                            <h2 id="preview-title" class="text-2xl font-bold text-center mb-6" data-lang="multiPreviewDefaultTitle">Page Title</h2>
                            <div id="preview-links" class="space-y-3">
                                <!-- Preview link dinamis akan ditambahkan di sini -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Bagian 2: UI Halaman Arahan (Landing Page) (Hidden by default) -->
    <div id="landing-page-ui" class="min-h-screen bg-gray-100 dark:bg-gray-900 hidden">
        <div class="container mx-auto max-w-lg p-6 pt-12">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 text-center">
                <h1 id="landing-title" class="text-3xl font-bold text-gray-800 dark:text-gray-100 mb-8"></h1>
                <div id="landing-links" class="space-y-4">
                    <!-- Tautan akan di-render di sini -->
                </div>
            </div>
            <p class="text-center text-gray-500 dark:text-gray-400 text-sm mt-6" data-lang="landingFooter">
                Created with QR Code Generator
            </p>
        </div>
    </div>

    <!-- Bagian 3: Modal History (IndexedDB) -->
    <div id="history-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-gray-900 dark:bg-gray-900 opacity-75 dark:opacity-75"></div>
        
        <div class="relative w-full max-w-4xl bg-white dark:bg-gray-800 rounded-lg shadow-xl flex flex-col" style="max-height: 90vh;">
            <!-- Header Modal -->
            <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
                <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100" data-lang="savedCodesTitle">My Saved Codes</h2>
                <button id="close-history-btn" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <!-- Konten Modal (Scrollable) -->
            <div id="history-content" class="p-6 overflow-y-auto space-y-4">
                <!-- Konten history dari IndexedDB akan di-render di sini -->
            </div>
        </div>
    </div>


    <script>
        // --- Bagian 0: Inisialisasi Sistem Terjemahan ---
        
        // Objek terjemahan
        const translations = {
            en: {
                title: "QR Code Generator Pro",
                subtitle: "Free QR Code Generator PRO Multi Function",
                heading1: "1. Select QR Code Type",
                tabSingle: "Single URL",
                tabMulti: "Multi URL",
                tabVcard: "vCard",
                tabWhatsapp: "WhatsApp",
                singleUrlLabel: "Enter your URL",
                singleUrlPlaceholder: "https://www.google.com",
                multiTitleLabel: "Page Title",
                multiTitlePlaceholder: "My Business Name",
                multiLinksHeading: "Links",
                multiAddLink: "Add Link",
                vcardHeading: "Enter Contact Details (vCard)",
                vcardFirstName: "First Name",
                vcardFirstNamePlaceholder: "John",
                vcardLastName: "Last Name",
                vcardLastNamePlaceholder: "Doe",
                vcardPhone: "Phone No.",
                vcardPhonePlaceholder: "+112345678",
                vcardEmail: "Email",
                vcardEmailPlaceholder: "john.doe@example.com",
                vcardCompany: "Company",
                vcardCompanyPlaceholder: "Acme Inc.",
                vcardJobTitle: "Job Title",
                vcardJobTitlePlaceholder: "Manager",
                vcardNote: "Note",
                vcardNotePlaceholder: "Additional notes...",
                vcardSocialHeading: "Social Media Profiles",
                vcardSocialHint: "Just enter your username.",
                vcardSocialPlaceholder: "Username",
                vcardAddSocial: "Add Other Social",
                vcardCustomHeading: "Other Custom Fields",
                vcardAddCustom: "Add Custom Field",
                waHeading: "Enter WhatsApp Number",
                waHint: "Will be auto-formatted to a wa.me link.",
                waLabel: "WhatsApp Number",
                waPlaceholder: "e.g. 08123456789",
                heading2: "2. Customize Design",
                styleColors: "Colors",
                styleDotsColor: "Dots",
                styleBgColor: "Background",
                styleCornerSquareColor: "Corner Square",
                styleCornerDotColor: "Corner Dot",
                styleStyles: "Styles",
                styleDotsStyle: "Dots Style",
                styleCornerStyle: "Corner Style",
                styleSquare: "Square",
                styleDots: "Dots",
                styleRounded: "Rounded",
                styleExtraRounded: "Extra Rounded",
                styleClassy: "Classy",
                styleClassyRounded: "Classy Rounded",
                styleDot: "Dot",
                styleLogo: "Logo",
                styleUploadLogo: "Select Logo",
                heading3: "3. Preview & Download",
                downloadPNG: "Download PNG",
                downloadSVG: "Download SVG",
                multiPreviewHeading: "Multi-URL Page Preview",
                multiPreviewDefaultTitle: "Page Title",
                landingFooter: "Created with QR Code Generator",
                // Teks dinamis (placeholder)
                multiLinkIcon: "Icon",
                multiLinkLabel: "Link Label",
                multiLinkLabelPlaceholder: "My Website",
                multiLinkUrl: "URL",
                multiLinkUrlPlaceholder: "https://...",
                multiLinkEmpty: "No links yet. Click 'Add Link' to start.",
                vcardCustomLabel: "Label",
                vcardCustomLabelPlaceholder: "e.g. Website",
                vcardCustomValue: "Value",
                vcardCustomValuePlaceholder: "e.g. https://...",
                vcardCustomEmpty: "No custom fields yet.",
                vcardCustomSocialLabelPlaceholder: "e.g. Mastodon",
                vcardCustomSocialValuePlaceholder: "Username",
                // TAMBAHAN BARU (IndexedDB & Share)
                myCodes: "My Codes",
                saveCode: "Save Code",
                savedCodesTitle: "My Saved Codes",
                shareLink: "Shareable Link (Multi URL)",
                copy: "Copy",
                copied: "Copied!",
                close: "Close",
                load: "Load",
                delete: "Delete",
                deleteConfirm: "Are you sure you want to delete this code?",
                noSavedCodes: "You have no saved QR codes yet. Click 'Save Code' in the generator to add one!",
                codeSaved: "QR Code saved!",
                codeLoaded: "QR Code loaded!",
                codeDeleted: "QR Code deleted."
            },
            id: {
                title: "QR Code Generator Pro",
                subtitle: "Free QR Code Generator PRO Multi Fungsi",
                heading1: "1. Pilih Tipe QR Code",
                tabSingle: "Single URL",
                tabMulti: "Multi URL",
                tabVcard: "vCard",
                tabWhatsapp: "WhatsApp",
                singleUrlLabel: "Masukkan URL Anda",
                singleUrlPlaceholder: "https://www.google.com",
                multiTitleLabel: "Judul Halaman",
                multiTitlePlaceholder: "Nama Bisnis Saya",
                multiLinksHeading: "Tautan (Links)",
                multiAddLink: "Tambah Tautan",
                vcardHeading: "Masukkan Detail Kontak (vCard)",
                vcardFirstName: "Nama Depan",
                vcardFirstNamePlaceholder: "John",
                vcardLastName: "Nama Belakang",
                vcardLastNamePlaceholder: "Doe",
                vcardPhone: "No. Telepon",
                vcardPhonePlaceholder: "+6281234567",
                vcardEmail: "Email",
                vcardEmailPlaceholder: "john.doe@example.com",
                vcardCompany: "Perusahaan",
                vcardCompanyPlaceholder: "Acme Inc.",
                vcardJobTitle: "Jabatan",
                vcardJobTitlePlaceholder: "Manajer",
                vcardNote: "Catatan",
                vcardNotePlaceholder: "Catatan tambahan...",
                vcardSocialHeading: "Profil Sosial Media",
                vcardSocialHint: "Cukup masukkan username Anda.",
                vcardSocialPlaceholder: "Username",
                vcardAddSocial: "Tambah Sosial Media Lain",
                vcardCustomHeading: "Kolom Kustom Lainnya",
                vcardAddCustom: "Tambah Kolom Kustom",
                waHeading: "Masukkan Nomor WhatsApp",
                waHint: "Akan diformat otomatis menjadi tautan wa.me.",
                waLabel: "Nomor WhatsApp",
                waPlaceholder: "cth. 08123456789",
                heading2: "2. Kustomisasi Tampilan",
                styleColors: "Warna",
                styleDotsColor: "Titik (Dots)",
                styleBgColor: "Latar Belakang",
                styleCornerSquareColor: "Sudut (Kotak)",
                styleCornerDotColor: "Sudut (Titik)",
                styleStyles: "Gaya",
                styleDotsStyle: "Gaya Titik",
                styleCornerStyle: "Gaya Sudut",
                styleSquare: "Kotak",
                styleDots: "Titik",
                styleRounded: "Bulat",
                styleExtraRounded: "Sangat Bulat",
                styleClassy: "Classy",
                styleClassyRounded: "Classy Bulat",
                styleDot: "Titik",
                styleLogo: "Logo",
                styleUploadLogo: "Pilih Logo",
                heading3: "3. Preview & Download",
                downloadPNG: "Download PNG",
                downloadSVG: "Download SVG",
                multiPreviewHeading: "Preview Halaman Multi-URL",
                multiPreviewDefaultTitle: "Judul Halaman",
                landingFooter: "Dibuat dengan QR Code Generator",
                // Teks dinamis (placeholder)
                multiLinkIcon: "Ikon",
                multiLinkLabel: "Label Tautan",
                multiLinkLabelPlaceholder: "Website Saya",
                multiLinkUrl: "URL",
                multiLinkUrlPlaceholder: "https://...",
                multiLinkEmpty: "Belum ada tautan. Klik 'Tambah Tautan' untuk memulai.",
                vcardCustomLabel: "Label",
                vcardCustomLabelPlaceholder: "cth: Website",
                vcardCustomValue: "Value",
                vcardCustomValuePlaceholder: "cth: https://...",
                vcardCustomEmpty: "Belum ada kolom kustom.",
                vcardCustomSocialLabelPlaceholder: "cth: Mastodon",
                vcardCustomSocialValuePlaceholder: "Username",
                // TAMBAHAN BARU (IndexedDB & Share)
                myCodes: "Kode Saya",
                saveCode: "Simpan Kode",
                savedCodesTitle: "Kode Tersimpan Saya",
                shareLink: "Tautan Bagikan (Multi URL)",
                copy: "Salin",
                copied: "Tersalin!",
                close: "Tutup",
                load: "Muat",
                delete: "Hapus",
                deleteConfirm: "Apakah Anda yakin ingin menghapus kode ini?",
                noSavedCodes: "Anda belum memiliki kode QR tersimpan. Klik 'Simpan Kode' di generator untuk menambahkannya!",
                codeSaved: "Kode QR disimpan!",
                codeLoaded: "Kode QR dimuat!",
                codeDeleted: "Kode QR dihapus."
            }
        };

        let currentLang = 'en'; // Default
        const langToggleBtn = document.getElementById('lang-toggle');

        // Fungsi untuk menerapkan bahasa
        function setLanguage(lang) {
            if (!translations[lang]) return;
            currentLang = lang;
            document.documentElement.lang = lang;
            localStorage.setItem('lang', lang);
            
            langToggleBtn.textContent = lang === 'en' ? 'ID' : 'EN';
            langToggleBtn.title = lang === 'en' ? 'Change Language' : 'Ganti Bahasa';

            // Ganti semua teks statis
            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });

            // Ganti semua placeholder
            document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.getAttribute('data-lang-placeholder');
                if (translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });
            
            // Perbarui UI dinamis
            if (typeof initGenerator === 'function') {
                const generatorUI = document.getElementById('generator-ui');
                if (generatorUI.style.display !== 'none') {
                    if (window.renderMultiLinksList) window.renderMultiLinksList();
                    if (window.renderVcardCustomFields) window.renderVcardCustomFields();
                    if (window.renderVcardCustomSocials) window.renderVcardCustomSocials();
                    // Update judul tombol my-codes
                    const myCodesBtn = document.getElementById('my-codes-btn');
                    if (myCodesBtn) myCodesBtn.title = translations[lang].myCodes;
                }
            }
        }

        // Listener untuk tombol bahasa
        langToggleBtn.addEventListener('click', () => {
            const newLang = currentLang === 'en' ? 'id' : 'en';
            setLanguage(newLang);
        });


        // --- Bagian 1: Pengecekan Mode (Generator vs Landing Page) ---

        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            const generatorUI = document.getElementById('generator-ui');
            const landingPageUI = document.getElementById('landing-page-ui');

            const initialLang = localStorage.getItem('lang') || 'en';
            
            if (dataParam) {
                // --- MODE HALAMAN ARAHAN (LANDING PAGE) ---
                try {
                    generatorUI.style.display = 'none';
                    landingPageUI.style.display = 'block';

                    const decodedData = JSON.parse(atob(dataParam));
                    const landingTitle = document.getElementById('landing-title');
                    landingTitle.textContent = decodedData.title || (initialLang === 'id' ? 'Tautan Saya' : 'My Links');
                    document.title = decodedData.title || (initialLang === 'id' ? 'Tautan Saya' : 'My Links');

                    const landingLinks = document.getElementById('landing-links');
                    landingLinks.innerHTML = ''; 

                    decodedData.links.forEach(link => {
                        const linkEl = document.createElement('a');
                        linkEl.href = link.url;
                        linkEl.target = '_blank';
                        linkEl.rel = 'noopener noreferrer';
                        linkEl.className = 'w-full flex items-center gap-4 p-4 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm text-left bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all transform hover:scale-105';
                        
                        linkEl.innerHTML = `
                            <span class="w-8 h-8 flex items-center justify-center bg-gray-100 dark:bg-gray-600 rounded-full text-indigo-600 dark:text-indigo-400">
                                <i data-lucide="${link.icon || 'link'}"></i>
                            </span>
                            <span class="flex-1 text-md font-medium text-gray-700 dark:text-gray-300">${link.label}</span>
                            <span class="text-gray-400 dark:text-gray-500">
                                <i data-lucide="arrow-up-right" class="w-4 h-4"></i>
                            </span>
                        `;
                        landingLinks.appendChild(linkEl);
                    });

                    lucide.createIcons();
                    setLanguage(initialLang); 

                } catch (e) {
                    console.error('Failed to parse Multi URL data:', e);
                    generatorUI.style.display = 'block';
                    landingPageUI.style.display = 'none';
                    initGenerator(); 
                }
            } else {
                // --- MODE GENERATOR (DEFAULT) ---
                initGenerator();
            }
        });

        // --- Bagian 2: Inisialisasi Mode Generator ---

        function initGenerator() {
            // --- Variabel Global & State ---
            let qrCodeInstance = null;
            let activeTab = 'single'; 
            let multiLinksData = [];
            let vcardCustomFields = [];
            let vcardCustomSocials = [];
            let logoImage = null; // Ini akan menyimpan Base64 dari logo
            let db = null; // Variabel untuk instance IndexedDB

            // --- Inisialisasi QR Code Instance ---
            qrCodeInstance = new QRCodeStyling({
                width: 224,
                height: 224,
                type: 'svg',
                data: 'https://github.com/gemini', // Default data
                image: '',
                dotsOptions: { color: '#000000', type: 'square' },
                backgroundOptions: { color: '#ffffff' },
                cornersSquareOptions: { color: '#000000', type: 'square' },
                cornersDotOptions: { color: '#000000', type: 'square' },
                imageOptions: { crossOrigin: 'anonymous', margin: 5 }
            });

            const qrCanvasWrapper = document.getElementById('qr-canvas-wrapper');
            qrCanvasWrapper.innerHTML = '';
            qrCodeInstance.append(qrCanvasWrapper);

            // --- Cache Elemen DOM ---
            const themeToggleBtn = document.getElementById('theme-toggle');
            
            const tabBtnSingle = document.getElementById('tab-btn-single');
            const tabBtnMulti = document.getElementById('tab-btn-multi');
            const tabPanelSingle = document.getElementById('tab-panel-single');
            const tabPanelMulti = document.getElementById('tab-panel-multi');
            const multiUrlPreviewWrapper = document.getElementById('multi-url-preview-wrapper');

            const tabBtnVcard = document.getElementById('tab-btn-vcard');
            const tabBtnWhatsapp = document.getElementById('tab-btn-whatsapp');
            const tabPanelVcard = document.getElementById('tab-panel-vcard');
            const tabPanelWhatsapp = document.getElementById('tab-panel-whatsapp');
            
            // Cache semua input data vCard (termasuk yang sosmed)
            const vcardInputs = document.querySelectorAll('#tab-panel-vcard .data-input, #tab-panel-vcard .vcard-input');
            
            const vcardCustomFieldsContainer = document.getElementById('vcard-custom-fields-container');
            const vcardAddFieldBtn = document.getElementById('vcard-add-field-btn');
            const vcardCustomSocialsContainer = document.getElementById('vcard-custom-socials-container');
            const vcardAddSocialBtn = document.getElementById('vcard-add-social-btn');

            const whatsappNumber = document.getElementById('whatsapp-number');
            const singleUrlInput = document.getElementById('single-url');
            const multiTitleInput = document.getElementById('multi-title');
            const addLinkBtn = document.getElementById('add-link-btn');
            const multiLinksContainer = document.getElementById('multi-links-container');

            const previewTitle = document.getElementById('preview-title');
            const previewLinksContainer = document.getElementById('preview-links');
            
            const colorDots = document.getElementById('color-dots');
            const colorBg = document.getElementById('color-bg');
            const colorCornerSquare = document.getElementById('color-corner-square');
            const colorCornerDot = document.getElementById('color-corner-dot');
            const styleDots = document.getElementById('style-dots');
            const styleCornerSquare = document.getElementById('style-corner-square');
            const logoUpload = document.getElementById('logo-upload');
            const logoRemove = document.getElementById('logo-remove');

            const downloadPngBtn = document.getElementById('download-png-btn');
            const downloadSvgBtn = document.getElementById('download-svg-btn');

            // Cache elemen baru (Share & DB)
            const myCodesBtn = document.getElementById('my-codes-btn');
            const saveQrBtn = document.getElementById('save-qr-btn');
            const shareLinkWrapper = document.getElementById('share-link-wrapper');
            const shareLinkInput = document.getElementById('share-link-input');
            const copyLinkBtn = document.getElementById('copy-link-btn');
            const historyModal = document.getElementById('history-modal');
            const historyContent = document.getElementById('history-content');
            const closeHistoryBtn = document.getElementById('close-history-btn');

            // --- Bagian 3: Fungsi IndexedDB ---

            function initDB() {
                const dbName = "QRGeneratorDB";
                const request = indexedDB.open(dbName, 1);

                request.onupgradeneeded = (e) => {
                    const dbInstance = e.target.result;
                    if (!dbInstance.objectStoreNames.contains('qrcodes')) {
                        // Buat object store 'qrcodes' dengan 'id' sebagai auto-incrementing key
                        dbInstance.createObjectStore('qrcodes', { keyPath: 'id', autoIncrement: true });
                    }
                };

                request.onsuccess = (e) => {
                    db = e.target.result;
                    console.log('Database initialized successfully.');
                };

                request.onerror = (e) => {
                    console.error('Error initializing database:', e.target.error);
                };
            }
            
            // Fungsi untuk mendapatkan semua data input saat ini
            function getCurrentConfig() {
                // Kumpulkan semua data vcard
                const vcardData = {};
                vcardInputs.forEach(input => {
                    if (input.id) { // Pastikan input punya ID
                        vcardData[input.id] = input.value;
                    }
                });
                
                return {
                    // Simpan semua style, termasuk logo base64 (jika ada)
                    styles: qrCodeInstance.options,
                    // Simpan data
                    activeTab: activeTab,
                    data: {
                        singleUrl: singleUrlInput.value,
                        multiTitle: multiTitleInput.value,
                        multiLinksData: multiLinksData, // array
                        vcardData: vcardData, // objek
                        vcardCustomFields: vcardCustomFields, // array
                        vcardCustomSocials: vcardCustomSocials, // array
                        whatsappNumber: whatsappNumber.value
                    },
                    timestamp: new Date().toISOString()
                };
            }

            function saveQRCode() {
                if (!db) {
                    console.error('Database is not initialized.');
                    return;
                }
                
                const config = getCurrentConfig();
                
                // Tentukan nama untuk preview
                let name = 'QR Code';
                try {
                    switch(config.activeTab) {
                        case 'single': name = config.data.singleUrl.substring(0, 50) || 'Single URL'; break;
                        case 'multi': name = config.data.multiTitle || 'Multi URL'; break;
                        case 'vcard': name = config.data.vcardData['vcard-first-name'] || 'vCard'; break;
                        case 'whatsapp': name = config.data.whatsappNumber || 'WhatsApp'; break;
                    }
                } catch (e) {}
                
                config.name = name; // Tambahkan nama ke config
                
                const transaction = db.transaction(['qrcodes'], 'readwrite');
                const store = transaction.objectStore('qrcodes');
                const request = store.add(config);
                
                request.onsuccess = () => {
                    console.log('QR Code saved successfully!');
                    // Beri notifikasi sederhana (opsional)
                    const originalText = saveQrBtn.textContent;
                    saveQrBtn.textContent = translations[currentLang].codeSaved;
                    saveQrBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                    saveQrBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
                    setTimeout(() => {
                        saveQrBtn.textContent = originalText;
                        saveQrBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                        saveQrBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                    }, 2000);
                };
                
                request.onerror = (e) => {
                    console.error('Error saving QR Code:', e.target.error);
                };
            }

            function showHistory() {
                if (!db) return;
                
                historyContent.innerHTML = ''; // Kosongkan
                historyModal.classList.remove('hidden');
                lucide.createIcons(); // Render ikon 'X' di tombol close

                const store = db.transaction('qrcodes').objectStore('qrcodes');
                const request = store.getAll();
                
                request.onsuccess = (e) => {
                    const codes = e.target.result.reverse(); // Tampilkan yang terbaru dulu
                    
                    if (codes.length === 0) {
                        historyContent.innerHTML = `<p class="text-gray-500 dark:text-gray-400 text-center">${translations[currentLang].noSavedCodes}</p>`;
                        return;
                    }
                    
                    codes.forEach(code => {
                        const date = new Date(code.timestamp).toLocaleString();
                        const card = document.createElement('div');
                        card.className = 'flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600';
                        
                        // Buat mini preview QR
                        const previewWrapper = document.createElement('div');
                        previewWrapper.className = 'w-20 h-20 bg-white dark:bg-gray-100 rounded-md flex-shrink-0 flex items-center justify-center';

                        // PERBAIKAN: Tambahkan pengecekan jika styles atau data tidak ada
                        if (code && code.styles && code.styles.data) {
                            new QRCodeStyling({
                                width: 80,
                                height: 80,
                                type: 'svg',
                                data: code.styles.data, // Data ada di dalam styles
                                image: code.styles.image,
                                dotsOptions: code.styles.dotsOptions,
                                backgroundOptions: { color: '#ffffff' }, // Paksa putih
                                cornersSquareOptions: code.styles.cornersSquareOptions,
                                cornersDotOptions: code.styles.cornersDotOptions,
                                imageOptions: code.styles.imageOptions
                            }).append(previewWrapper);
                        } else {
                            // Tampilkan placeholder jika data rusak
                            previewWrapper.innerHTML = `<i data-lucide="image-off" class="w-10 h-10 text-gray-400"></i>`;
                        }

                        card.innerHTML = `
                            <div class="flex-1 min-w-0">
                                <p class="text-lg font-semibold text-indigo-600 dark:text-indigo-400 truncate" title="${code.name || ''}">${code.name || 'Untitled'}</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${(code.activeTab || 'N/A').toUpperCase()} &bull; ${date}</p>
                            </div>
                            <div class="flex-shrink-0 flex gap-2">
                                <button data-id="${code.id}" class="load-code-btn p-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md">
                                    <i data-lucide="upload" class="w-4 h-4 inline-block mr-1"></i>
                                    ${translations[currentLang].load}
                                </button>
                                <button data-id="${code.id}" class="delete-code-btn p-2 text-gray-600 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900 hover:text-red-600 dark:hover:text-red-500 rounded-md">
                                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                                </button>
                            </div>
                        `;
                        // Sisipkan preview QR di awal card
                        card.prepend(previewWrapper);
                        historyContent.appendChild(card);
                    });
                    
                    lucide.createIcons();
                };
            }
            
            function loadQRCode(id) {
                if (!db) return;
                
                const store = db.transaction('qrcodes').objectStore('qrcodes');
                const request = store.get(id);
                
                request.onsuccess = (e) => {
                    const config = e.target.result;
                    if (!config) {
                        console.error('Config not found');
                        return;
                    }
                    
                    // 1. Restore Styles
                    qrCodeInstance.update(config.styles);
                    logoImage = config.styles.image || null; // Restore logo global
                    // Update input kustomisasi (agar UI sinkron)
                    colorDots.value = config.styles.dotsOptions.color || '#000000';
                    colorBg.value = config.styles.backgroundOptions.color || '#ffffff';
                    colorCornerSquare.value = config.styles.cornersSquareOptions.color || '#000000';
                    colorCornerDot.value = config.styles.cornersDotOptions.color || '#000000';
                    styleDots.value = config.styles.dotsOptions.type || 'square';
                    styleCornerSquare.value = config.styles.cornersSquareOptions.type || 'square';

                    // 2. Restore Data
                    const data = config.data;
                    singleUrlInput.value = data.singleUrl || '';
                    multiTitleInput.value = data.multiTitle || '';
                    multiLinksData = data.multiLinksData || [];
                    
                    // Restore vcard inputs
                    if (data.vcardData) {
                        for (const [id, value] of Object.entries(data.vcardData)) {
                            const el = document.getElementById(id);
                            if (el) el.value = value;
                        }
                    }
                    vcardCustomFields = data.vcardCustomFields || [];
                    vcardCustomSocials = data.vcardCustomSocials || [];
                    
                    whatsappNumber.value = data.whatsappNumber || '';
                    
                    // 3. Render Ulang UI
                    renderMultiLinksList();
                    renderVcardCustomFields();
                    renderVcardCustomSocials();
                    
                    // 4. Set Tab Aktif
                    setActiveTab(config.activeTab);
                    
                    // 5. Tutup Modal
                    historyModal.classList.add('hidden');
                    console.log('QR Code loaded!');
                };
            }

            function deleteQRCode(id) {
                if (!db) return;
                
                if (!confirm(translations[currentLang].deleteConfirm)) {
                    return;
                }
                
                const transaction = db.transaction(['qrcodes'], 'readwrite');
                const store = transaction.objectStore('qrcodes');
                const request = store.delete(id);
                
                request.onsuccess = () => {
                    console.log('QR Code deleted');
                    showHistory(); // Refresh tampilan history
                };
            }


            // --- Fungsi Helper Lainnya ---
            
            function updateThemeIcon() {
                lucide.createIcons();
            }

            function formatWaNumber(numberStr) {
                if (!numberStr) return 'https://wa.me/';
                let num = numberStr.replace(/[\s\-()]/g, '');
                if (num.startsWith('+')) num = num.substring(1);
                if (num.startsWith('0')) num = '62' + num.substring(1);
                if (!num.startsWith('62')) num = '62' + num;
                return 'https://wa.me/' + num;
            }

            function updateQrData() {
                let dataToEncode = 'https://github.com/gemini';
                
                switch (activeTab) {
                    case 'single':
                        dataToEncode = singleUrlInput.value || dataToEncode;
                        break;
                    
                    case 'multi':
                        const title = multiTitleInput.value || (currentLang === 'id' ? 'Tautan Saya' : 'My Links');
                        const links = multiLinksData.map(link => ({
                            icon: link.icon,
                            label: link.label,
                            url: link.url
                        }));
                        
                        const dataObject = { title, links };
                        const encodedData = btoa(JSON.stringify(dataObject));
                        const baseUrl = window.location.href.split('?')[0];
                        dataToEncode = `${baseUrl}?data=${encodedData}`;
                        
                        // Update input share link
                        shareLinkInput.value = dataToEncode;
                        break;

                    case 'vcard':
                        let vcardLines = [ 'BEGIN:VCARD', 'VERSION:3.0' ];
                        
                        // Ambil dari objek vcardData yang sudah di-cache
                        const vCardForm = {};
                        vcardInputs.forEach(input => { if (input.id) vCardForm[input.id] = input.value; });

                        vcardLines.push(`N:${vCardForm['vcard-last-name'] || ''};${vCardForm['vcard-first-name'] || ''};;;`);
                        vcardLines.push(`FN:${vCardForm['vcard-first-name'] || ''} ${vCardForm['vcard-last-name'] || ''}`);
                        vcardLines.push(`ORG:${vCardForm['vcard-company'] || ''}`);
                        vcardLines.push(`TITLE:${vCardForm['vcard-title'] || ''}`);
                        vcardLines.push(`TEL;TYPE=CELL:${vCardForm['vcard-phone'] || ''}`);
                        vcardLines.push(`EMAIL:${vCardForm['vcard-email'] || ''}`);
                        vcardLines.push(`NOTE:${vCardForm['vcard-note'] || ''}`);

                        const socials = {
                            facebook: vCardForm['vcard-social-facebook'],
                            instagram: vCardForm['vcard-social-instagram'],
                            tiktok: vCardForm['vcard-social-tiktok'],
                            linkedin: vCardForm['vcard-social-linkedin'],
                            twitter: vCardForm['vcard-social-twitter']
                        };
                        
                        for (const [type, username] of Object.entries(socials)) {
                            if (username) vcardLines.push(`X-SOCIALPROFILE;TYPE=${type}:${username.replace('@', '')}`);
                        }
                        
                        vcardCustomSocials.forEach(social => {
                            if (social.label && social.value) vcardLines.push(`X-SOCIALPROFILE;TYPE=${social.label.toLowerCase().replace(/[^a-z0-9-]/g, '')}:${social.value.replace('@', '')}`);
                        });

                        vcardCustomFields.forEach(field => {
                            if (field.label && field.value) {
                                const label = field.label.toLowerCase();
                                if (label === 'website') vcardLines.push(`URL:${field.value}`);
                                else if (label === 'alamat' || label === 'address') vcardLines.push(`ADR;TYPE=HOME:;;${field.value};;;;`);
                                else vcardLines.push(`X-${field.label.replace(/[^A-Za-z0-9-]/g, '').toUpperCase()}:${field.value}`);
                            }
                        });

                        vcardLines.push('END:VCARD');
                        dataToEncode = vcardLines.join('\n');
                        break;
                    
                    case 'whatsapp':
                        dataToEncode = formatWaNumber(whatsappNumber.value);
                        break;
                }

                qrCodeInstance.update({ data: dataToEncode });
            }

            // Fungsi render dinamis (dibuat global di window agar setLanguage bisa memanggilnya)
            window.renderMultiLinksList = function() {
                multiLinksContainer.innerHTML = '';
                const lang = currentLang;
                
                if (multiLinksData.length === 0) {
                    multiLinksContainer.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400 text-center">${translations[lang].multiLinkEmpty}</p>`;
                }

                multiLinksData.forEach((link, index) => {
                    const linkEl = document.createElement('div');
                    linkEl.className = 'p-3 border border-gray-200 dark:border-gray-700 rounded-md space-y-2 relative';
                    linkEl.innerHTML = `
                        <button data-id="${link.id}" class="remove-link-btn absolute -top-2 -right-2 p-1 bg-red-100 text-red-600 rounded-full hover:bg-red-200 dark:bg-red-900 dark:text-red-400 dark:hover:bg-red-800">
                            <i data-lucide="x" class="w-3 h-3"></i>
                        </button>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-xs font-medium text-gray-600 dark:text-gray-400">${translations[lang].multiLinkIcon}</label>
                                <select data-id="${link.id}" data-field="icon" class="multi-link-input w-full mt-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-500 dark:bg-gray-600 dark:text-white rounded-md shadow-sm">
                                    <option value="link" ${link.icon === 'link' ? 'selected' : ''}>Link</option>
                                    <option value="globe" ${link.icon === 'globe' ? 'selected' : ''}>Website</option>
                                    <option value="instagram" ${link.icon === 'instagram' ? 'selected' : ''}>Instagram</option>
                                    <option value="linkedin" ${link.icon === 'linkedin' ? 'selected' : ''}>LinkedIn</option>
                                    <option value="facebook" ${link.icon === 'facebook' ? 'selected' : ''}>Facebook</option>
                                    <option value="twitter" ${link.icon === 'twitter' ? 'selected' : ''}>Twitter</option>
                                    <option value="youtube" ${link.icon === 'youtube' ? 'selected' : ''}>YouTube</option>
                                    <option value="github" ${link.icon === 'github' ? 'selected' : ''}>Github</option>
                                    <option value="tiktok" ${link.icon === 'tiktok' ? 'selected' : ''}>TikTok</option>
                                    <option value="shopping-cart" ${link.icon === 'shopping-cart' ? 'selected' : ''}>Shop</option>
                                    <option value="mail" ${link.icon === 'mail' ? 'selected' : ''}>Email</option>
                                    <option value="phone" ${link.icon === 'phone' ? 'selected' : ''}>Phone</option>
                                </select>
                            </div>
                             <div>
                                <label class="block text-xs font-medium text-gray-600 dark:text-gray-400">${translations[lang].multiLinkLabel}</label>
                                <input type="text" data-id="${link.id}" data-field="label" value="${link.label}" placeholder="${translations[lang].multiLinkLabelPlaceholder}" class="multi-link-input w-full mt-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-500 dark:bg-gray-600 dark:text-white rounded-md shadow-sm">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 dark:text-gray-400">${translations[lang].multiLinkUrl}</label>
                            <input type="url" data-id="${link.id}" data-field="url" value="${link.url}" placeholder="${translations[lang].multiLinkUrlPlaceholder}" class="multi-link-input w-full mt-1 px-2 py-1 text-sm border border-gray-300 dark:border-gray-500 dark:bg-gray-600 dark:text-white rounded-md shadow-sm">
                        </div>
                    `;
                    multiLinksContainer.appendChild(linkEl);
                });
                
                lucide.createIcons();
                updateMultiUrlPreview();
                updateQrData();
            }
            
            function updateMultiUrlPreview() {
                const title = multiTitleInput.value;
                previewTitle.textContent = title || translations[currentLang].multiPreviewDefaultTitle;
                
                previewLinksContainer.innerHTML = '';
                
                multiLinksData.forEach(link => {
                    const linkEl = document.createElement('div');
                    linkEl.className = 'w-full flex items-center gap-3 p-3 border border-gray-200 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 shadow-sm';
                    linkEl.innerHTML = `
                        <span class="w-6 h-6 flex items-center justify-center bg-gray-100 dark:bg-gray-600 rounded-full text-indigo-600 dark:text-indigo-400 text-xs">
                           <i data-lucide="${link.icon || 'link'}" class="w-4 h-4"></i>
                        </span>
                        <span class="flex-1 text-sm font-medium text-gray-700 dark:text-gray-300">${link.label || translations[currentLang].multiLinkLabel}</span>
                        <span class="text-gray-300 dark:text-gray-500">
                           <i data-lucide="arrow-up-right" class="w-3 h-3"></i>
                        </span>
                    `;
                    previewLinksContainer.appendChild(linkEl);
                });
                
                if (multiLinksData.length === 0) {
                    previewLinksContainer.innerHTML = `<p class="text-xs text-gray-400 dark:text-gray-500 text-center p-4">${translations[currentLang].multiLinkEmpty}</p>`;
                }
                
                lucide.createIcons();
            }

            window.renderVcardCustomFields = function() {
                vcardCustomFieldsContainer.innerHTML = '';
                const lang = currentLang;

                if (vcardCustomFields.length === 0) {
                    vcardCustomFieldsContainer.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400 text-center">${translations[lang].vcardCustomEmpty}</p>`;
                }
                
                vcardCustomFields.forEach(field => {
                    const fieldEl = document.createElement('div');
                    fieldEl.className = 'grid grid-cols-10 gap-2 items-center';
                    fieldEl.innerHTML = `
                        <input type="text" data-id="${field.id}" data-field="label" value="${field.label}" placeholder="${translations[lang].vcardCustomLabelPlaceholder}" class="vcard-custom-input col-span-4 w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-500 dark:bg-gray-600 dark:text-white rounded-md shadow-sm">
                        <input type="text" data-id="${field.id}" data-field="value" value="${field.value}" placeholder="${translations[lang].vcardCustomValuePlaceholder}" class="vcard-custom-input col-span-5 w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-500 dark:bg-gray-600 dark:text-white rounded-md shadow-sm">
                        <button data-id="${field.id}" class="vcard-remove-field-btn text-gray-400 dark:text-gray-500 hover:text-red-600 dark:hover:text-red-500 justify-self-center">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    `;
                    vcardCustomFieldsContainer.appendChild(fieldEl);
                });
                
                lucide.createIcons();
                updateQrData();
            }

            window.renderVcardCustomSocials = function() {
                vcardCustomSocialsContainer.innerHTML = '';
                const lang = currentLang;
                
                vcardCustomSocials.forEach(social => {
                    const fieldEl = document.createElement('div');
                    fieldEl.className = 'grid grid-cols-10 gap-2 items-center';
                    fieldEl.innerHTML = `
                        <input type="text" data-id="${social.id}" data-field="label" value="${social.label}" placeholder="${translations[lang].vcardCustomSocialLabelPlaceholder}" class="vcard-custom-social-input col-span-4 w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-500 dark:bg-gray-600 dark:text-white rounded-md shadow-sm">
                        <input type="text" data-id="${social.id}" data-field="value" value="${social.value}" placeholder="${translations[lang].vcardCustomSocialValuePlaceholder}" class="vcard-custom-social-input col-span-5 w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-500 dark:bg-gray-600 dark:text-white rounded-md shadow-sm">
                        <button data-id="${social.id}" class="vcard-remove-social-btn text-gray-400 dark:text-gray-500 hover:text-red-600 dark:hover:text-red-500 justify-self-center">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    `;
                    vcardCustomSocialsContainer.appendChild(fieldEl);
                });
                
                lucide.createIcons();
                updateQrData();
            }


            // --- Event Listeners ---

            themeToggleBtn.addEventListener('click', () => {
                const isDarkMode = document.documentElement.classList.toggle('dark');
                localStorage.theme = isDarkMode ? 'dark' : 'light';
            });

            const tabs = [
                { btn: tabBtnSingle, panel: tabPanelSingle, name: 'single' },
                { btn: tabBtnMulti, panel: tabPanelMulti, name: 'multi' },
                { btn: tabBtnVcard, panel: tabPanelVcard, name: 'vcard' },
                { btn: tabBtnWhatsapp, panel: tabPanelWhatsapp, name: 'whatsapp' }
            ];

            function setActiveTab(tabName) {
                activeTab = tabName;
                
                tabs.forEach(tab => {
                    const isActive = tab.name === tabName;
                    tab.btn.classList.toggle('bg-indigo-600', isActive);
                    tab.btn.classList.toggle('text-white', isActive);
                    tab.btn.classList.toggle('bg-white', !isActive);
                    tab.btn.classList.toggle('text-gray-700', !isActive);
                    tab.btn.classList.toggle('hover:bg-gray-50', !isActive);
                    tab.btn.classList.toggle('border', !isActive);
                    tab.btn.classList.toggle('dark:bg-gray-700', !isActive);
                    tab.btn.classList.toggle('dark:text-gray-300', !isActive);
                    tab.btn.classList.toggle('dark:hover:bg-gray-600', !isActive);
                    tab.btn.classList.toggle('dark:border-gray-600', !isActive);
                    tab.panel.style.display = isActive ? 'block' : 'none';
                });

                // Tampilkan/sembunyikan wrapper share link
                shareLinkWrapper.style.display = (tabName === 'multi') ? 'block' : 'none';
                multiUrlPreviewWrapper.style.display = (tabName === 'multi') ? 'block' : 'none';
                
                updateQrData();
            }

            tabs.forEach(tab => {
                tab.btn.addEventListener('click', () => setActiveTab(tab.name));
            });
                
            // Listener untuk semua input data (kecuali yang dinamis)
            singleUrlInput.addEventListener('input', updateQrData);
            multiTitleInput.addEventListener('input', () => {
                updateMultiUrlPreview();
                updateQrData();
            });
            vcardInputs.forEach(input => input.addEventListener('input', updateQrData));
            whatsappNumber.addEventListener('input', updateQrData);
            
            // Listener untuk link dinamis (Multi URL)
            addLinkBtn.addEventListener('click', () => {
                multiLinksData.push({ id: Date.now().toString(), icon: 'link', label: '', url: '' });
                renderMultiLinksList();
            });
            multiLinksContainer.addEventListener('input', (e) => {
                if (e.target.classList.contains('multi-link-input')) {
                    const link = multiLinksData.find(l => l.id === e.target.dataset.id);
                    if (link) link[e.target.dataset.field] = e.target.value;
                    updateMultiUrlPreview();
                    updateQrData();
                }
            });
            multiLinksContainer.addEventListener('click', (e) => {
                const removeBtn = e.target.closest('.remove-link-btn');
                if (removeBtn) {
                    multiLinksData = multiLinksData.filter(l => l.id !== removeBtn.dataset.id);
                    renderMultiLinksList();
                }
            });

            // Listener untuk field dinamis (vCard Custom)
            vcardAddFieldBtn.addEventListener('click', () => {
                vcardCustomFields.push({ id: Date.now().toString(), label: '', value: '' });
                renderVcardCustomFields();
            });
            vcardCustomFieldsContainer.addEventListener('input', (e) => {
                if (e.target.classList.contains('vcard-custom-input')) {
                    const field = vcardCustomFields.find(f => f.id === e.target.dataset.id);
                    if (field) field[e.target.dataset.field] = e.target.value;
                    updateQrData();
                }
            });
            vcardCustomFieldsContainer.addEventListener('click', (e) => {
                const removeBtn = e.target.closest('.vcard-remove-field-btn');
                if (removeBtn) {
                    vcardCustomFields = vcardCustomFields.filter(f => f.id !== removeBtn.dataset.id);
                    renderVcardCustomFields();
                }
            });
            
            // Listener untuk field dinamis (vCard Social Custom)
            vcardAddSocialBtn.addEventListener('click', () => {
                vcardCustomSocials.push({ id: Date.now().toString(), label: '', value: '' });
                renderVcardCustomSocials();
            });
            vcardCustomSocialsContainer.addEventListener('input', (e) => {
                if (e.target.classList.contains('vcard-custom-social-input')) {
                    const social = vcardCustomSocials.find(f => f.id === e.target.dataset.id);
                    if (social) social[e.target.dataset.field] = e.target.value;
                    updateQrData();
                }
            });
            vcardCustomSocialsContainer.addEventListener('click', (e) => {
                const removeBtn = e.target.closest('.vcard-remove-social-btn');
                if (removeBtn) {
                    vcardCustomSocials = vcardCustomSocials.filter(f => f.id !== removeBtn.dataset.id);
                    renderVcardCustomSocials();
                }
            });

            // Listener Kustomisasi
            colorDots.addEventListener('input', (e) => qrCodeInstance.update({ dotsOptions: { color: e.target.value } }));
            colorBg.addEventListener('input', (e) => qrCodeInstance.update({ backgroundOptions: { color: e.target.value } }));
            colorCornerSquare.addEventListener('input', (e) => qrCodeInstance.update({ cornersSquareOptions: { color: e.target.value } }));
            colorCornerDot.addEventListener('input', (e) => qrCodeInstance.update({ cornersDotOptions: { color: e.target.value } }));
            styleDots.addEventListener('change', (e) => qrCodeInstance.update({ dotsOptions: { type: e.target.value } }));
            styleCornerSquare.addEventListener('change', (e) => qrCodeInstance.update({ cornersSquareOptions: { type: e.target.value } }));

            // Listener Logo
            logoUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    logoImage = event.target.result; // Simpan base64
                    qrCodeInstance.update({ image: logoImage });
                };
                reader.readAsDataURL(file);
            });
            logoRemove.addEventListener('click', () => {
                logoImage = null;
                logoUpload.value = '';
                qrCodeInstance.update({ image: null });
            });
            
            // Listener Download
            downloadPngBtn.addEventListener('click', () => qrCodeInstance.download({ name: 'qr-code', extension: 'png' }));
            downloadSvgBtn.addEventListener('click', () => qrCodeInstance.download({ name: 'qr-code', extension: 'svg' }));

            // --- Listener Baru (Share & DB) ---
            
            copyLinkBtn.addEventListener('click', () => {
                shareLinkInput.select();
                document.execCommand('copy'); // Sesuai instruksi persona (lebih kompatibel)
                
                const originalText = copyLinkBtn.innerHTML;
                copyLinkBtn.innerHTML = `<i data-lucide="check" class="w-4 h-4 text-green-600"></i>`;
                lucide.createIcons();
                setTimeout(() => {
                    copyLinkBtn.innerHTML = originalText;
                    lucide.createIcons();
                }, 2000);
            });
            
            saveQrBtn.addEventListener('click', saveQRCode);

            myCodesBtn.addEventListener('click', showHistory);
            
            closeHistoryBtn.addEventListener('click', () => {
                historyModal.classList.add('hidden');
            });

            // Event delegation untuk tombol Load & Delete di modal
            historyContent.addEventListener('click', (e) => {
                const loadBtn = e.target.closest('.load-code-btn');
                if (loadBtn) {
                    const id = parseInt(loadBtn.dataset.id, 10);
                    loadQRCode(id);
                    return;
                }
                
                const deleteBtn = e.target.closest('.delete-code-btn');
                if (deleteBtn) {
                    const id = parseInt(deleteBtn.dataset.id, 10);
                    deleteQRCode(id);
                    return;
                }
            });

            
            // --- Inisialisasi Awal ---
            initDB(); // Inisialisasi IndexedDB
            
            const initialLang = localStorage.getItem('lang') || 'en';
            setLanguage(initialLang);
            
            renderMultiLinksList();
            renderVcardCustomFields();
            renderVcardCustomSocials();
            
            updateThemeIcon();
            lucide.createIcons();
        }

    </script>
</body>
</html>
